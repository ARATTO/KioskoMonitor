var _0x5a35=['port','handshake','partials','Estado\x20extendido\x20\x20del\x20Impresor:\x20','ping_ip','log','ver_hwClienteData','userMail','Algo\x20pasó\x20al\x20intentar\x20cargar\x20los\x20usuarios,\x20check\x20index.js','./routes/usuario','Listo','listen','Error\x20Detectado:\x20','IpId:\x20','connection','./lib/secret','0\x2018\x20*\x20*\x20sunday','sendFile','env','Estado\x20del\x20Impresor:\x20','urlencoded','Se\x20ejecutó\x20iniciarEstadosKioskos','ready','INSERT\x20INTO\x20tblalertas_log\x20(idequipo,descripcion)\x0a\x09\x09\x09\x09\x20\x20VALUES\x20((SELECT\x20idequipo\x20FROM\x20tblequipo\x20WHERE\x20ipID=?),?)','addWarning','refresh_lista_equipos','session','UPDATE\x20tblusuario\x20SET\x20password=?\x20WHERE\x20idusuario\x20=\x20?','fillOffline','/logout','printerStatus','listening\x20on\x20*:','default','then','./public/js/setServerDb.js','./contadores','push','\x20-\x20detectedError=','SELECT\x20idusuario,\x20email,\x20password,\x20idPerfil,\x20estado\x20FROM\x20tblusuario\x20WHERE\x20(estado\x20<>\x200\x20AND\x20estado\x20<>\x202)','generalState','idPerfil','static','Respuesta\x20=\x20','idusuario','release','addReady','join','Respuesta','offline','emit','Server','**************************************************************','gbmsv','redirect','ver_hwCliente','trim','Error\x20Detectado\x20Extendido:\x20','ipID','detalle_hwCliente','indexOf','fillDatosTblEquipo','control','Estado\x20(string):\x20','Router','./routes/kiosko','layouts','\x20-\x20generalState=','express-handlebars','/username','promise','username','Printer\x20Name:\x20','Cache-Control','Cliente\x20desconectado...','Listado\x20de\x20usuarios\x20cargados\x20en\x20memoria,\x20total\x20','/login_error.html','sockets','conexion_cliente','email','length','Estados\x20warning:\x20','extendedDetectedErrorState','Se\x20ha\x20registrado\x20un\x20nuevo\x20evento\x20en\x20el\x20log,\x20equipo:\x20','get','getConnection','Select\x20idusuario,\x20email,\x20password,\x20idPerfil,estado\x20from\x20tblusuario\x20WHERE\x20(estado\x20<>\x200\x20AND\x20estado\x20<>\x202)','INSERT\x20INTO\x20tblalertas_log\x20(idequipo,descripcion)\x0a\x09\x09\x09\x09\x09\x20\x20VALUES\x20((SELECT\x20idequipo\x20FROM\x20tblequipo\x20WHERE\x20ipID=?),?)','path','esPrinterZebra','idperfil','connect-flash','/public','datosTblEquipo','view\x20engine','route','Cliente\x20Conectado...','userPerfil','Estados\x20ready:\x20','flash','setInitialState','/index.html','¿Es\x20printer\x20Zebra?','toString','header','latido_equipo_ok','Listado\x20de\x20equipos\x20enviados\x20a\x20GUI\x20de\x20monitoreo!','/kiosko','private,\x20no-cache,\x20no-store,\x20must-revalidate','detectedErrorState','IP:\x20','socket.io','bind','disconnect','post','.hbs','ver_status','morgan','\x20-\x20extendedDetectedError=','success','query','views','password','warning','host','setTotal','splice','./routes/logs','PORT','undefined','done','user','*****ERROR\x20en\x20funcion\x20encryptOnDataBase,\x20index.js','/public/index.html','decrypt','ping_ipResp','./lib/handlebars','destroy','Total\x20clientes\x20conectados:\x20','use','mysql','/usuario','set','ping','Tarea\x20programada\x20ejecutada...\x20Se\x20ha\x20eliminado\x20el\x20log\x20de\x20alertas\x20posterior\x20a\x203\x20meses!','body','encrypt','schedule','\x20Printer=','body-parser','json','dbServer','printerName','/login','Se\x20ha\x20registrado\x20un\x20nuevo\x20evento\x20desconexion\x20el\x20log,\x20equipo:\x20','node-cron','idUsuario','pass','ipClienteX','createPool','----','registrar_log','extendedPrinterStatus','Se\x20perdió\x20conexión\x20con\x20cliente\x20de\x20monitoreo','probe'];(function(_0x332144,_0x50d162){var _0x1c60c3=function(_0x33bcce){while(--_0x33bcce){_0x332144['push'](_0x332144['shift']());}};_0x1c60c3(++_0x50d162);}(_0x5a35,0x9e));var _0x4787=function(_0x332144,_0x50d162){_0x332144=_0x332144-0x0;var _0x1c60c3=_0x5a35[_0x332144];return _0x1c60c3;};const express=require('express');const morgan=require(_0x4787('0x7a'));const bodyP=require(_0x4787('0x9a'));const exphbs=require(_0x4787('0x49'));const path=require(_0x4787('0x5d'));const flash=require(_0x4787('0x60'));const session=require('express-session');const SimpleCrypto=require('simple-crypto-js')[_0x4787('0x26')];const _secretKey=require(_0x4787('0x15'));let simpleCrypto=new SimpleCrypto(_secretKey);let cron=require(_0x4787('0xa0'));let estado=require(_0x4787('0x29'));const app=express();app[_0x4787('0x93')]('views',path[_0x4787('0x34')](__dirname,_0x4787('0x7e')));app['engine']('.hbs',exphbs({'defaultLayout':'main','layoutsDir':path[_0x4787('0x34')](app['get'](_0x4787('0x7e')),_0x4787('0x47')),'partialsDir':path[_0x4787('0x34')](app[_0x4787('0x59')](_0x4787('0x7e')),_0x4787('0x8')),'extname':_0x4787('0x78'),'helpers':require(_0x4787('0x8d'))}));app[_0x4787('0x93')](_0x4787('0x63'),'.hbs');app[_0x4787('0x90')](session({'secret':_0x4787('0x3a'),'resave':!![],'saveUninitialized':![],'rolling':!![],'cookie':{'expires':0x493e0}}));app[_0x4787('0x90')](flash());app[_0x4787('0x90')](bodyP[_0x4787('0x1a')]({'extended':![]}));app[_0x4787('0x90')](bodyP[_0x4787('0x9b')]());app[_0x4787('0x90')]((_0x516dac,_0x11ee1f,_0x9b51f)=>{app['locals']['success']=_0x516dac[_0x4787('0x68')](_0x4787('0x7c'));_0x9b51f();});app[_0x4787('0x90')](require('./routes'));app['use'](_0x4787('0x70'),require(_0x4787('0x46')));app['use'](_0x4787('0x92'),require(_0x4787('0xf')));app[_0x4787('0x90')]('/logs',require(_0x4787('0x84')));var http=require('http')[_0x4787('0x38')](app);var ping=require(_0x4787('0x94'));var io=require(_0x4787('0x74'))(http);var database=require(_0x4787('0x28'))[_0x4787('0x9c')];var router=express[_0x4787('0x45')]();var bodyParser=require(_0x4787('0x9a'));app[_0x4787('0x90')](bodyParser[_0x4787('0x9b')]());app[_0x4787('0x90')](bodyParser[_0x4787('0x1a')]({'extended':![]}));var port=process[_0x4787('0x18')][_0x4787('0x85')]||0xbb8;var mysql=require(_0x4787('0x91'));var pool=mysql[_0x4787('0x0')]({'host':database[_0x4787('0x81')],'user':database[_0x4787('0x88')],'password':database[_0x4787('0xa2')],'insecureAuth':!![],'database':database['db'],'port':database[_0x4787('0x6')]});var socketCount=0x0;var equiposConectados=[];var equiposAlertados=[];var ipIdCliente=-0x1;var quitarIpId=-0x1,quitarIpIdPos=-0x1;var listEquipos='SELECT\x20*\x20FROM\x20tblequipo\x20WHERE\x20estado=1\x20LIMIT\x20500';var usersInfo=[];var usuariosConectados=[];var sess;router['get']('/',requireLogin,function(_0x290923,_0xb5164c){sess=_0x290923[_0x4787('0x20')];_0xb5164c['header'](_0x4787('0x4e'),_0x4787('0x71'));_0xb5164c[_0x4787('0x17')](__dirname+_0x4787('0x8a'));});router[_0x4787('0x59')](_0x4787('0x6a'),requireLogin,function(_0x3556ad,_0x6dc796){sess=_0x3556ad[_0x4787('0x20')];_0x6dc796[_0x4787('0x6d')](_0x4787('0x4e'),_0x4787('0x71'));_0x6dc796['sendFile'](__dirname+_0x4787('0x8a'));});router[_0x4787('0x64')](_0x4787('0x9e'))[_0x4787('0x59')](function(_0x37ecb8,_0x1ba6cc){_0x1ba6cc[_0x4787('0x6d')]('Cache-Control','private,\x20no-cache,\x20no-store,\x20must-revalidate');_0x1ba6cc[_0x4787('0x17')](__dirname+'/public/login.html');})[_0x4787('0x77')](async function(_0x311608,_0x20aa32){await refrescarUsuarios();sess=_0x311608[_0x4787('0x20')];var _0x1d5a49=_0x311608[_0x4787('0x96')];var _0x4e4ea2=sesionUsuario['buscar'](usersInfo,_0x1d5a49['loginUsuario'],_0x1d5a49['loginPassword']);if(_0x4e4ea2!==-0x1){sess[_0x4787('0x4c')]=_0x1d5a49['loginUsuario'];sess[_0x4787('0x54')]=_0x4e4ea2[_0x4787('0xd')];sess['idperfil']=_0x4e4ea2[_0x4787('0x66')];sess[_0x4787('0x31')]=_0x4e4ea2[_0x4787('0xa1')];_0x20aa32[_0x4787('0x3b')]('/index.html');}else{_0x20aa32['redirect'](_0x4787('0x51'));}});router['get'](_0x4787('0x23'),function(_0x3d209f,_0x57693e){_0x3d209f[_0x4787('0x20')][_0x4787('0x8e')]();_0x57693e['redirect'](_0x4787('0x9e'));});router[_0x4787('0x59')](_0x4787('0x4a'),function(_0x3cb34d,_0x7d6cf2){sess=_0x3cb34d[_0x4787('0x20')];_0x7d6cf2[_0x4787('0x9b')]({'myUserName':sess['username'],'myUserId':sess[_0x4787('0x54')],'myPerfil':sess[_0x4787('0x5f')],'myIdUsuario':sess[_0x4787('0x31')]});});app['use']('/',router);app[_0x4787('0x90')](express[_0x4787('0x2f')](__dirname+_0x4787('0x61')));function requireLogin(_0x54319c,_0x5a6b52,_0x198d59){sess=_0x54319c[_0x4787('0x20')];_0x54319c[_0x4787('0x20')]['touch']();if(!sess[_0x4787('0x4c')]){_0x5a6b52[_0x4787('0x3b')](_0x4787('0x9e'));}else{_0x198d59();}};pool[_0x4787('0x5a')](function(_0x4953ad,_0x4cf9a2){usersInfo[_0x4787('0x55')]=0x0;var _0x5f1ce3=_0x4787('0x5b');_0x4cf9a2[_0x4787('0x7d')](_0x5f1ce3,async function(_0x422c6c,_0x27e7c3){if(_0x422c6c){console[_0x4787('0xb')](_0x422c6c);return;}else{usersInfo=await decryptPass(_0x27e7c3);console[_0x4787('0xb')]('Listado\x20de\x20usuarios\x20cargados\x20en\x20memoria,\x20total\x20'+usersInfo['length']);}_0x4cf9a2[_0x4787('0x32')]();});});function refrescarUsuarios(){pool[_0x4787('0x5a')](function(_0x24a9ad,_0x3d28a7){var _0x2ed554=_0x4787('0x2c');_0x3d28a7[_0x4787('0x7d')](_0x2ed554,async function(_0x1f60dc,_0x192649){if(_0x1f60dc){console[_0x4787('0xb')](_0x1f60dc);return;}else{usersInfo=await decryptPass(_0x192649);console[_0x4787('0xb')](_0x4787('0x50')+usersInfo[_0x4787('0x55')]);}_0x3d28a7['release']();});});}function decryptPass(_0x3e2be9){if(_0x3e2be9[0x0]){for(let _0x2a3a32=0x0;_0x2a3a32<_0x3e2be9[_0x4787('0x55')];_0x2a3a32++){let _0x4fddf4=simpleCrypto[_0x4787('0x8b')](_0x3e2be9[_0x2a3a32][_0x4787('0x7f')]);_0x3e2be9[_0x2a3a32][_0x4787('0x7f')]=_0x4fddf4;}return _0x3e2be9;}return{'error':_0x4787('0xe')};}async function encryptOnDataBase(_0x168161){if(_0x168161[0x0]){for(let _0x52143a=0x0;_0x52143a<_0x168161['length'];_0x52143a++){let _0x2a095f=simpleCrypto[_0x4787('0x97')](_0x168161[_0x52143a][_0x4787('0x7f')]);await pool[_0x4787('0x7d')](_0x4787('0x21'),[_0x2a095f,_0x168161[_0x52143a][_0x4787('0x31')]]);}}console[_0x4787('0xb')](_0x4787('0x89'));}var sesionUsuario={'buscar':function(_0xc0512b,_0xcdbb4f,_0x4dc4d5){for(var _0x23f937=0x0;_0x23f937<_0xc0512b[_0x4787('0x55')];_0x23f937++){if(_0xc0512b[_0x23f937][_0x4787('0x54')]===_0xcdbb4f[_0x4787('0x3d')]()&&_0xc0512b[_0x23f937][_0x4787('0x7f')]===_0x4dc4d5[_0x4787('0x3d')]()){return{'userMail':_0xc0512b[_0x23f937][_0x4787('0x54')],'userPerfil':_0xc0512b[_0x23f937][_0x4787('0x2e')],'idUsuario':_0xc0512b[_0x23f937][_0x4787('0x31')]};}}return-0x1;}};cron[_0x4787('0x98')](_0x4787('0x16'),()=>{pool['query']('DELETE\x20FROM\x20tblalertas_log\x20WHERE\x20fecha\x20<\x20DATE_SUB(NOW(),\x20INTERVAL\x203\x20MONTH)');console[_0x4787('0xb')](_0x4787('0x95'));});function iniciarEstadosKioskos(){estado[_0x4787('0x69')]();pool[_0x4787('0x7d')](listEquipos,function(_0x8995f9,_0x1f3db5,_0x44e1ad){if(_0x8995f9)throw _0x8995f9;estado[_0x4787('0x82')](_0x1f3db5[_0x4787('0x55')]);estado[_0x4787('0x22')](_0x1f3db5);estado[_0x4787('0x42')](_0x1f3db5);});}iniciarEstadosKioskos();io['on'](_0x4787('0x14'),function(_0x15deb7){ipIdCliente=_0x15deb7[_0x4787('0x7')][_0x4787('0x7d')][_0x4787('0xa3')];socketCount++;console[_0x4787('0xb')]('++++');if(typeof ipIdCliente!==_0x4787('0x86')&&ipIdCliente!==null){console[_0x4787('0xb')](_0x4787('0x65')+ipIdCliente);if(equiposConectados[_0x4787('0x41')](ipIdCliente)==-0x1){equiposConectados['push'](ipIdCliente);estado[_0x4787('0x33')](ipIdCliente);}console[_0x4787('0xb')](_0x4787('0x8f')+equiposConectados[_0x4787('0x55')]);}else{console['log']('Cliente\x20conectado\x20a\x20Interfaz\x20de\x20monitoreo,\x20socket.id='+_0x15deb7['id']);io[_0x4787('0x52')]['emit']('mostrar_lstEquipos',estado[_0x4787('0x62')],estado['ready'],estado[_0x4787('0x80')],estado[_0x4787('0x36')],equiposConectados[_0x4787('0x55')]);console['log'](_0x4787('0x6f'));}_0x15deb7['on'](_0x4787('0x79'),function(_0x22bad7){console[_0x4787('0xb')]('IP\x20Cliente:\x20'+_0x22bad7['ip']);console[_0x4787('0xb')](_0x4787('0x13')+_0x22bad7[_0x4787('0x3f')]);console[_0x4787('0xb')](_0x4787('0x4d')+_0x22bad7[_0x4787('0x9d')]);console[_0x4787('0xb')](_0x4787('0x19')+_0x22bad7[_0x4787('0x2d')]);console[_0x4787('0xb')](_0x4787('0x44')+_0x22bad7['printerStatus']);console[_0x4787('0xb')](_0x4787('0x9')+_0x22bad7[_0x4787('0x3')]);console[_0x4787('0xb')](_0x4787('0x12')+_0x22bad7[_0x4787('0x72')]);console[_0x4787('0xb')](_0x4787('0x3e')+_0x22bad7[_0x4787('0x57')]);console[_0x4787('0xb')](_0x4787('0x6b'),_0x22bad7[_0x4787('0x5e')]);console[_0x4787('0xb')]('Contador\x20papel:\x20'+_0x22bad7[_0x4787('0x43')]);console[_0x4787('0xb')]('.......');if(equiposConectados[_0x4787('0x41')](_0x22bad7[_0x4787('0x3f')])===-0x1){equiposConectados[_0x4787('0x2a')](_0x22bad7[_0x4787('0x3f')]);}if(_0x22bad7['generalState']===_0x4787('0x10')){estado[_0x4787('0x33')](_0x22bad7['ipID']);console['log'](_0x4787('0x67'),estado[_0x4787('0x1c')]);}else{estado[_0x4787('0x1e')](_0x22bad7[_0x4787('0x3f')]);console[_0x4787('0xb')](_0x4787('0x56'),estado[_0x4787('0x80')]);}io['sockets'][_0x4787('0x37')](_0x4787('0x6e'),_0x22bad7,equiposConectados[_0x4787('0x55')],estado[_0x4787('0x1c')],estado[_0x4787('0x80')],estado[_0x4787('0x36')]);});_0x15deb7['on'](_0x4787('0x3c'),function(_0x45eacd){io[_0x4787('0x52')][_0x4787('0x37')](_0x4787('0xc'),_0x45eacd);});_0x15deb7['on'](_0x4787('0x40'),function(_0x29e70b,_0x233879,_0x15fd61,_0x40ff82){io[_0x4787('0x52')][_0x4787('0x37')]('detalle_hwClienteShow',{'os':_0x29e70b,'cpu':_0x233879,'detMem':_0x15fd61,'detDisk':_0x40ff82});});var _0x325118=![];function _0x320bf7(_0x5b754a){var _0xd407d=![];ping[_0x4787('0x4b')][_0x4787('0x5')](_0x5b754a)[_0x4787('0x27')](function(_0x5de4cf){_0x10e6c6(_0x5de4cf);})[_0x4787('0x87')]();return _0x325118;};function _0x10e6c6(_0x29d6b3){_0x325118=_0x29d6b3['alive'];};_0x15deb7['on'](_0x4787('0xa'),function(_0x351927){var _0x1f493b=0x0;for(var _0xd9606b=0x0;_0xd9606b<=_0x351927[_0x4787('0x55')]-0x1;_0xd9606b++){ping['sys']['probe'](_0x351927[_0xd9606b]['ip'][_0x4787('0x6c')](),function(_0x4c9022){if(_0x4c9022){_0x1f493b=0x1;}else{_0x1f493b=0x0;}_0x351927[this['p']][_0x4787('0x35')]=_0x1f493b;io[_0x4787('0x52')][_0x4787('0x37')](_0x4787('0x8c'),_0x351927[this['p']]);}[_0x4787('0x75')]({'p':_0xd9606b}));console[_0x4787('0xb')](_0x4787('0x30')+_0x1f493b);console[_0x4787('0xb')]('################################################');console[_0x4787('0xb')](_0x4787('0x73')+_0x351927[_0xd9606b]['ip']+'\x20'+_0x351927[_0xd9606b]['Respuesta']);}});_0x15deb7['on'](_0x4787('0x2'),function(_0x2d4532){console[_0x4787('0xb')](_0x4787('0x39'));pool[_0x4787('0x5a')](function(_0x59ad83,_0xb7babc){var _0x1102f7=_0x4787('0x5c');var _0x20f689=_0x4787('0x99')+_0x2d4532['printerName']+_0x4787('0x48')+_0x2d4532[_0x4787('0x2d')]+'\x20-\x20printerStatus='+_0x2d4532[_0x4787('0x24')]+'\x20-\x20extendedPrinterStatus='+_0x2d4532[_0x4787('0x3')]+_0x4787('0x2b')+_0x2d4532['detectedErrorState']+_0x4787('0x7b')+_0x2d4532[_0x4787('0x57')];_0xb7babc[_0x4787('0x7d')](_0x1102f7,[_0x2d4532[_0x4787('0x3f')],_0x20f689],async function(_0x47c41f,_0x58dbba){if(_0x47c41f){console[_0x4787('0xb')](_0x47c41f);return;}else{console['log'](_0x4787('0x58')+_0x2d4532['ip']);}_0xb7babc[_0x4787('0x32')]();});});});_0x15deb7['on'](_0x4787('0x1f'),async function(){await iniciarEstadosKioskos();console[_0x4787('0xb')](_0x4787('0x1b'));});_0x15deb7['on'](_0x4787('0x76'),function(){socketCount--;quitarIpId=_0x15deb7[_0x4787('0x7')][_0x4787('0x7d')][_0x4787('0xa3')];if(typeof quitarIpId!==_0x4787('0x86')&&quitarIpId!==null){estado['addOffline'](quitarIpId);quitarIpIdPos=equiposConectados['indexOf'](quitarIpId);equiposConectados[_0x4787('0x83')](quitarIpIdPos,0x1);io[_0x4787('0x52')][_0x4787('0x37')](_0x4787('0x53'),equiposConectados['length']);_0xa54055(quitarIpId,_0x4787('0x4'));}io['sockets'][_0x4787('0x37')]('equipo_desconectado',quitarIpId,equiposConectados[_0x4787('0x55')],estado[_0x4787('0x1c')],estado[_0x4787('0x80')],estado[_0x4787('0x36')]);console[_0x4787('0xb')](_0x4787('0x1'));console[_0x4787('0xb')](_0x4787('0x4f')+quitarIpId);console[_0x4787('0xb')](_0x4787('0x8f')+equiposConectados[_0x4787('0x55')]);console[_0x4787('0xb')]('---');});function _0xa54055(_0x31c966,_0x328119){if(_0x31c966>0x0&&_0x328119!==''&&_0x328119!==undefined&&_0x328119!==null){pool[_0x4787('0x5a')](function(_0xdb3fa8,_0x274068){var _0x4980e0=_0x4787('0x1d');_0x274068['query'](_0x4980e0,[_0x31c966,_0x328119],async function(_0x583beb,_0x56ba58){if(_0x583beb){console[_0x4787('0xb')](_0x583beb);return;}else{console[_0x4787('0xb')](_0x4787('0x9f')+_0x31c966);}_0x274068['release']();});});}}});http[_0x4787('0x11')](port,function(){console[_0x4787('0xb')](_0x4787('0x25')+port);});